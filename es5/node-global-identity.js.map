{"version":3,"sources":["../lib/node-global-identity.js"],"names":[],"mappings":"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","file":"node-global-identity.js","sourcesContent":["import request from 'request-promise';\r\nimport lodash from 'lodash';\r\n\r\nexport function renameKeys(data) {\r\n  if (typeof data !== 'object' || typeof data === 'undefined' || data === null) {\r\n    return data;\r\n  }\r\n\r\n  const result = {};\r\n  const keys = Object.keys(data);\r\n\r\n  keys.forEach((key) => {\r\n    result[lodash.snakeCase(key)] = renameKeys(data[key]);\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nfunction handleError(json, reject) {\r\n    return reject({ message: json.OperationReport[0].Message });\r\n}\r\n\r\nfunction response(res, resolve, reject) {\r\n  const json = JSON.parse(res);\r\n\r\n  if (json.Success) {\r\n    delete json.OperationReport;\r\n    return resolve(renameKeys(json));\r\n  }\r\n\r\n  return handleError(json, reject);\r\n}\r\n\r\nexport default class {\r\n  constructor(obj = {}) {\r\n    this._apiKey = obj.apiKey;\r\n    this._url = obj.url;\r\n  }\r\n\r\n  setApiKey(apiKey) {\r\n    this._apiKey = apiKey;\r\n  }\r\n\r\n  setUrl(url) {\r\n    this._url = url;\r\n  }\r\n\r\n  authenticate(email, password) {\r\n    return new Promise((resolve, reject) => {\r\n      if (!this._url) {\r\n        return reject({ message: 'Must have url' });\r\n      }\r\n\r\n      if (!this._apiKey) {\r\n        return reject({ message: 'Must have an apiKey' });\r\n      }\r\n\r\n      if (!email) {\r\n        return reject({ message: 'Must have an email' });\r\n      }\r\n\r\n      if (!password) {\r\n        return reject({ message: 'Must have a password' });\r\n      }\r\n\r\n      const body = {\r\n        Email: email,\r\n        Password: password,\r\n        ApplicationKey: this._apiKey,\r\n      };\r\n\r\n      return request({\r\n        method: 'POST',\r\n        uri: this._getUrl('/api/Authorization/Authenticate'),\r\n        body: JSON.stringify(body),\r\n      }).then((res) => {\r\n        return response(res, resolve, reject);\r\n      }).catch((err) => {\r\n        return handleError(JSON.parse(err.error), reject);\r\n      });\r\n    });\r\n  }\r\n\r\n  validateToken(token) {\r\n    return new Promise((resolve, reject) => {\r\n      if (!this._url) {\r\n        return reject({ message: 'Must have url' });\r\n      }\r\n\r\n      if (!this._apiKey) {\r\n        return reject({ message: 'Must have an apiKey' });\r\n      }\r\n\r\n      if (!token) {\r\n        return reject({ message: 'Must have a token' });\r\n      }\r\n\r\n      const body = {\r\n        ApplicationKey: this._apiKey,\r\n        Token: token,\r\n      };\r\n\r\n      return request({\r\n        method: 'POST',\r\n        uri: this._getUrl('/api/Authorization/ValidateToken'),\r\n        body: JSON.stringify(body),\r\n      }).then((res) => {\r\n        return response(res, resolve, reject);\r\n      }).catch((err) => {\r\n        return handleError(JSON.parse(err.error), reject);\r\n      });\r\n    });\r\n  }\r\n\r\n  _getUrl(endpoint) {\r\n    return this._url + endpoint;\r\n  }\r\n}\r\n"]}